<!DOCTYPE html>
<html>
<head>
    <title>Movie Mood Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="chat-wrapper">

    <div class="chat-header">
        ğŸ¿ Movie Mood Chatbot
        <a href="/logout" class="logout-btn">Logout</a>
    </div>

    <div id="chat-box" class="chat-box"></div>

    <div class="input-area">
        <input type="text" id="msg"
               placeholder="Ask for movies like magic âœ¨"
               onkeydown="if(event.key==='Enter') sendMsg()">
        <button onclick="sendMsg()">ğŸš€</button>
    </div>

</div>

<script>

function addMessage(text, sender){
    let msgDiv = document.createElement("div");
    msgDiv.className = sender === "user" ? "message user" : "message bot";
    msgDiv.innerHTML = text;

    let chatBox = document.getElementById("chat-box");
    chatBox.appendChild(msgDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMsg(){
    let input = document.getElementById("msg");
    let message = input.value.trim();
    if(!message) return;

    addMessage(message, "user");
    input.value = "";

    fetch("/chat", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({message: message})
    })
    .then(res => res.json())
    .then(data => {

        if(data.type === "text"){
            addMessage(data.reply, "bot");
        }

        else if(data.type === "movies"){
            data.movies.forEach(m => {
                addMessage(
                    `ğŸ¥ <b>${m.Movie}</b> â­ ${m.Rating} <br>
                     ğŸ”— <a href="${m.Link}" target="_blank">Watch Trailer</a>`,
                    "bot"
                );
            });

            addMessage("âœ¨ Enjoy your movie time!", "bot");
        }
    })
    .catch(() => {
        addMessage("âš  Server error. Try again.", "bot");
    });
}

// ğŸ‘‡ Greeting with username
addMessage("Hi {{ username }} ğŸ‘‹ How are you feeling today? ğŸ˜Š", "bot");

</script>

</body>
</html>
